/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{682:function(wa,ua,b){b.r(ua);var la=b(0),na=b(7),oa=b(2);wa=b(53);var ka=b(38),ia=b(21);b=function(){function ea(){this.init()}ea.prototype.init=function(){this.xya=!1;this.lh=this.vq=this.connection=null;this.wm={};this.ha=this.$R=null};ea.prototype.TC=function(x){for(var y=this,h=0;h<x.length;++h){var e=x[h];switch(e.at){case "create":this.wm[e.author]||(this.wm[e.author]=e.aName);this.BLa(e);break;case "modify":this.ha.eu(e.xfdf).then(function(f){y.ha.Ib(f[0])});
break;case "delete":e="<delete><id>".concat(e.aId,"</id></delete>"),this.ha.eu(e)}}};ea.prototype.BLa=function(x){var y=this;this.ha.eu(x.xfdf).then(function(h){h=h[0];h.authorId=x.author;y.ha.Ib(h);y.ha.trigger(na.d.UPDATE_ANNOTATION_PERMISSION,[h])})};ea.prototype.lKa=function(x,y,h){this.vq&&this.vq(x,y,h)};ea.prototype.preloadAnnotations=function(x){this.addEventListener("webViewerServerAnnotationsEnabled",this.lKa.bind(this,x,"add",{imported:!1}),{once:!0})};ea.prototype.initiateCollaboration=
function(x,y,h){var e=this;if(x){e.lh=y;e.ha=h.ia();h.addEventListener(na.i.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.A1a(x);var f=new XMLHttpRequest;f.addEventListener("load",function(){if(200===f.status&&0<f.responseText.length)try{var w=JSON.parse(f.responseText);e.connection=exports.da.l3a(Object(ka.l)(e.lh,"blackbox/"),"annot");e.$R=w.id;e.wm[w.id]=w.user_name;e.ha.v2(w.id);e.connection.j7a(function(n){n.t&&n.t.startsWith("a_")&&n.data&&e.TC(n.data)},function(){e.connection.send({t:"a_retrieve",
dId:x});e.trigger(ea.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.wm[w.id],e.$R])},function(){e.disableCollaboration()})}catch(n){Object(oa.g)(n.message)}});f.open("GET",Object(ka.l)(this.lh,"demo/SessionInfo.jsp"));f.withCredentials=!0;f.send();e.xya=!0;e.ha.qka(function(w){return e.wm[w.Author]||w.Author})}else Object(oa.g)("Document ID required for collaboration")};ea.prototype.disableCollaboration=function(){this.vq&&(this.ha.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.vq),this.vq=
null);this.connection&&this.connection.zw();this.ha&&this.ha.v2("Guest");this.init();this.trigger(ea.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};ea.prototype.A1a=function(x){var y=this;this.vq&&this.ha.removeEventListener(ia.a.Events.ANNOTATION_CHANGED,this.vq);this.vq=function(h,e,f){return Object(la.c)(this,void 0,void 0,function(){var w,n,a,r,z,ba,ha,aa,ca;return Object(la.e)(this,function(fa){switch(fa.label){case 0:if(f.imported)return[2];w={t:"a_".concat(e),dId:x,annots:[]};return[4,y.ha.eba()];
case 1:n=fa.aa();"delete"!==e&&(a=(new DOMParser).parseFromString(n,"text/xml"),r=new XMLSerializer);for(z=0;z<h.length;z++)ba=h[z],aa=ha=void 0,"add"===e?(ha=a.querySelector('[name="'.concat(ba.Id,'"]')),aa=r.serializeToString(ha),ca=null,ba.InReplyTo&&(ca=y.ha.Hf(ba.InReplyTo).authorId||"default"),w.annots.push({at:"create",aId:ba.Id,author:y.$R,aName:y.wm[y.$R],parent:ca,xfdf:"<add>".concat(aa,"</add>")})):"modify"===e?(ha=a.querySelector('[name="'.concat(ba.Id,'"]')),aa=r.serializeToString(ha),
w.annots.push({at:"modify",aId:ba.Id,xfdf:"<modify>".concat(aa,"</modify>")})):"delete"===e&&w.annots.push({at:"delete",aId:ba.Id});0<w.annots.length&&y.connection.send(w);return[2]}})})}.bind(y);this.ha.addEventListener(ia.a.Events.ANNOTATION_CHANGED,this.vq)};ea.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return ea}();Object(wa.a)(b);ua["default"]=b}}]);}).call(this || window)
